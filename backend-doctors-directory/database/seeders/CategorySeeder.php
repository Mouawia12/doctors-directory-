<?php

namespace Database\Seeders;

use App\Models\Category;
use Illuminate\Database\Seeder;
use Illuminate\Support\Str;

class CategorySeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $issues = [
            'اضطراب القلق العام',
            'اضطراب الهلع',
            'الرهاب الاجتماعي',
            'الرهاب المحدد',
            'قلق الانفصال',
            'الاكتئاب الشديد',
            'الاكتئاب المستمر (ديستيميا)',
            'الاضطراب ثنائي القطب',
            'اضطراب ما بعد الصدمة',
            'الصدمة المعقدة',
            'اضطراب التكيّف',
            'اضطراب الوسواس القهري',
            'تشوّه صورة الجسد',
            'نتف الشعر',
            'قضم الأظافر',
            'القهم العصبي',
            'الشره العصبي',
            'نهم الأكل',
            'الأرق',
            'اضطرابات النوم المرتبطة بالضغط أو القلق',
            'إدمان المواد',
            'الإدمان السلوكي (الألعاب، التسوق، الجنس)',
            'الفصام',
            'الاضطراب الفصامي العاطفي',
            'الاضطراب الوهمي',
            'اضطراب فرط الحركة وتشتت الانتباه',
            'طيف التوحد',
            'صعوبات التعلّم',
            'اضطرابات التواصل',
            'اضطراب التحدّي والمعارضة',
            'اضطراب السلوك',
            'مشكلات التعلّق',
            'العلاقات المؤذية',
            'الاعتماد العاطفي',
            'انعدام الحدود',
            'تدنّي تقدير الذات',
            'نقد الذات المفرط',
            'ضياع الهوية',
            'العزلة الوجودية',
            'فقدان المعنى',
            'الحزن والفقد',
            'الاحتراق النفسي',
            'الضغوط المهنية',
            'صعوبات اتخاذ القرار',
            'مشكلات التواصل',
            'اضطراب القلق من المرض',
            'الاضطراب الجسدي الشكل',
        ];

        $tree = [
            'التخصصات النفسية' => [
                'عالم نفس',
                'أخصائي نفسي إكلينيكي',
                'أخصائي نفسي إرشادي',
                'معالج زواجي وأسري',
                'معالج زواجي وأسري مُرخّص',
                'مستشار مهني مُرخّص',
                'مستشار صحة نفسية مُرخّص',
                'مستشار مهني–إكلينيكي مُرخّص',
                'أخصائي خدمة اجتماعية إكلينيكي مُرخّص',
                'أخصائي خدمة اجتماعية إكلينيكي',
                'معالج نفسي',
                'مستشار صحة نفسية',
            ],
            'القضايا والمشكلات النفسية' => $issues,
        ];

        foreach ($tree as $parentName => $children) {
            /** @var Category $parent */
            $parent = Category::firstOrCreate(
                ['name' => $parentName],
                ['slug' => $this->slugify($parentName)]
            );

            foreach ($children as $childName) {
                Category::firstOrCreate(
                    ['name' => $childName, 'parent_id' => $parent->id],
                    ['slug' => $this->slugify($childName)]
                );
            }
        }
    }

    protected function slugify(string $value): string
    {
        $slug = Str::slug($value, '-', 'ar') ?: Str::slug(Str::ascii($value, 'ar'));

        return $slug !== '' ? $slug : Str::random(8);
    }
}
